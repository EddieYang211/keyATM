---
title: "keyATM Covariates"
output: 
  html_document:
    toc: true
---

```{r setup II, include=FALSE, eval=TRUE}
knitr::opts_chunk$set(eval = T, echo = TRUE)
```

## Preparing documents and covariates
The `docvar` function in the **quanteda** package is especially useful 
to construct a `vector` or a `dataframe` of covariates because it ensures that
documents and covariates are corresponding to each other. 
Since the **keyATM** does not take missing values,
we recommend researchers to remove any missing values from 
covariates before extracting them using the `docvars`.
Moreover, we strongly recommend researchers to 
extract covariates *after* preprocessing texts 
because preprocessing steps will remove documents without any terms,
which may result in any discrepancies between documents and covariates.
Therefore, the recommended procedure is
(1) removing missing values from covariates, (2) preprocessing texts 
(including the process to discard documents that do not contain any words),
and (3) extracting covariates using `docvar` function.

In this example, we create a period dummy and a party dummy from the corpus
and use them as covariates for the covariate keyATM. 
First, we extract covariates attached to each document in the corpus 
with the `docvar` function.


## Fitting the model
```{r, warning=FALSE, message=FALSE, fig.align='center', results="hide"}
out <- keyATM(
              docs              = keyATM_docs,                            # text input
              no_keyword_topics = 3,                                      # number of topics without keywords
              keywords          = bills_keywords,                         # keywords (a list)
              model             = "covariates",                           # select the model
              model_settings    = list(covariates_data    = bills_cov,    # covariate data
                                       covariates_formula = ~ RepParty,   # formula to fit covarite
                                       mh_use             = FALSE),       # use Metloporis Hastings
              options           = list(seed = 250)
             )
```
The `covariates_formula` takes the same form of a [`formula`](https://rdrr.io/r/stats/formula.html) for `model.matrix()` function. You do not need to specify the left hand side of the formula. The default number of iterations is `1500`. Please check [this page](Options.html) for available options.


## Saving the model

Once you fit the model, you can save the model with `save()` for replication. This is the same as the [Base model](keyATM_base.html#saving-the-model).

## Checking top words
```{r, warning=FALSE, message=FALSE, fig.align='center'}
top_words(out)
```

## Reference
```
Adler, E Scott and John Wilkerson. 2018. ``Congressional bills project.'' NSF 880066 and 0080061:213â€“227.
```


